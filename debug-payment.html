<!DOCTYPE html>
<html>
<head>
    <title>Payment Debug Tool</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a2e; color: white; }
        .container { max-width: 600px; margin: 0 auto; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #2d5a2d; }
        .error { background: #5a2d2d; }
        .warning { background: #5a5a2d; }
        .info { background: #2d2d5a; }
        button { padding: 10px 20px; margin: 5px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #45a049; }
        .address { font-family: monospace; background: #333; padding: 5px; border-radius: 3px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Payment Debug Tool</h1>
        
        <div id="wallet-status" class="status info">
            <h3>Wallet Status</h3>
            <p>Checking wallet connection...</p>
        </div>

        <div id="network-status" class="status info">
            <h3>Network Status</h3>
            <p>Checking network...</p>
        </div>

        <div id="balance-status" class="status info">
            <h3>USDC Balance</h3>
            <p>Checking USDC balance...</p>
        </div>

        <div id="transaction-status" class="status info">
            <h3>Recent Transactions</h3>
            <p>Checking recent transactions...</p>
        </div>

        <div style="margin-top: 20px;">
            <button onclick="checkWallet()">üîç Refresh All Checks</button>
            <button onclick="openBaseScan()">üîó Open BaseScan</button>
            <button onclick="getTestUSDC()">üíß Get Test USDC</button>
        </div>

        <div style="margin-top: 30px; padding: 20px; background: #2d2d5a; border-radius: 10px;">
            <h3>üí° Quick Solutions:</h3>
            <ul>
                <li><strong>Wrong Network:</strong> Switch to Base Network in your wallet</li>
                <li><strong>No USDC:</strong> Get USDC from Uniswap or bridge from Ethereum</li>
                <li><strong>Pending Transaction:</strong> Check your wallet for stuck transactions</li>
                <li><strong>Insufficient Gas:</strong> Make sure you have ETH for gas fees</li>
            </ul>
        </div>
    </div>

    <script>
        // Check if MetaMask is installed
        function checkWallet() {
            const walletStatus = document.getElementById('wallet-status');
            const networkStatus = document.getElementById('network-status');
            const balanceStatus = document.getElementById('balance-status');
            
            if (typeof window.ethereum === 'undefined') {
                walletStatus.className = 'status error';
                walletStatus.innerHTML = '<h3>‚ùå Wallet Status</h3><p>MetaMask not detected. Please install MetaMask.</p>';
                return;
            }

            // Check wallet connection
            window.ethereum.request({ method: 'eth_accounts' })
                .then(accounts => {
                    if (accounts.length === 0) {
                        walletStatus.className = 'status warning';
                        walletStatus.innerHTML = '<h3>‚ö†Ô∏è Wallet Status</h3><p>Wallet not connected. Please connect your wallet.</p>';
                    } else {
                        walletStatus.className = 'status success';
                        walletStatus.innerHTML = `<h3>‚úÖ Wallet Status</h3><p>Connected: <span class="address">${accounts[0]}</span></p>`;
                        
                        // Check network
                        checkNetwork();
                        checkBalance(accounts[0]);
                    }
                })
                .catch(err => {
                    walletStatus.className = 'status error';
                    walletStatus.innerHTML = `<h3>‚ùå Wallet Status</h3><p>Error: ${err.message}</p>`;
                });
        }

        function checkNetwork() {
            const networkStatus = document.getElementById('network-status');
            
            window.ethereum.request({ method: 'eth_chainId' })
                .then(chainId => {
                    const baseChainId = '0x2105'; // Base mainnet
                    const testnetChainId = '0x14a33'; // Base Sepolia testnet
                    
                    if (chainId === baseChainId) {
                        networkStatus.className = 'status success';
                        networkStatus.innerHTML = '<h3>‚úÖ Network Status</h3><p>Connected to Base Mainnet</p>';
                    } else if (chainId === testnetChainId) {
                        networkStatus.className = 'status warning';
                        networkStatus.innerHTML = '<h3>‚ö†Ô∏è Network Status</h3><p>Connected to Base Sepolia Testnet (not mainnet)</p>';
                    } else {
                        networkStatus.className = 'status error';
                        networkStatus.innerHTML = `<h3>‚ùå Network Status</h3><p>Wrong network. Chain ID: ${chainId}. Please switch to Base.</p>`;
                    }
                })
                .catch(err => {
                    networkStatus.className = 'status error';
                    networkStatus.innerHTML = `<h3>‚ùå Network Status</h3><p>Error: ${err.message}</p>`;
                });
        }

        function checkBalance(address) {
            const balanceStatus = document.getElementById('balance-status');
            
            // USDC contract on Base
            const usdcContract = '0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913';
            
            // Get USDC balance
            const data = '0x70a08231' + address.slice(2).padStart(64, '0');
            
            window.ethereum.request({
                method: 'eth_call',
                params: [
                    { to: usdcContract, data: data },
                    'latest'
                ]
            })
            .then(result => {
                const balance = parseInt(result, 16) / 1e6; // USDC has 6 decimals
                if (balance >= 0.20) {
                    balanceStatus.className = 'status success';
                    balanceStatus.innerHTML = `<h3>‚úÖ USDC Balance</h3><p>You have ${balance.toFixed(2)} USDC (sufficient)</p>`;
                } else {
                    balanceStatus.className = 'status error';
                    balanceStatus.innerHTML = `<h3>‚ùå USDC Balance</h3><p>You have ${balance.toFixed(2)} USDC (need 0.20)</p>`;
                }
            })
            .catch(err => {
                balanceStatus.className = 'status error';
                balanceStatus.innerHTML = `<h3>‚ùå USDC Balance</h3><p>Error checking balance: ${err.message}</p>`;
            });
        }

        function openBaseScan() {
            window.open('https://basescan.org/', '_blank');
        }

        function getTestUSDC() {
            alert('To get USDC on Base:\n\n1. Bridge from Ethereum using Base Bridge\n2. Buy on Uniswap V3 on Base\n3. Use Coinbase to send USDC to Base\n\nFor testnet: Use Base Sepolia faucets');
        }

        // Run checks on page load
        window.addEventListener('load', checkWallet);
    </script>
</body>
</html>
